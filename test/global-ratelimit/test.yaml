admin:
  access_log_path: ./envoy_debug.log
  address:
    socket_address:
      address: 127.0.0.1
      port_value: 8080
static_resources:
  listeners:
    name: listener_meta_protocol
    address:
      socket_address:
        address: 0.0.0.0
        port_value: 30000
    filter_chains:
      - filters:
          - name: aeraki.meta_protocol_proxy
            typed_config:
              '@type': type.googleapis.com/aeraki.meta_protocol_proxy.v1alpha.MetaProtocolProxy
              application_protocol: trpc
              codec:
                name: aeraki.meta_protocol.codec.trpc
              metaProtocolFilters:
                - name: aeraki.meta_protocol.filters.router
                - name: aeraki.meta_protocol.filters.ratelimit
                  config:
                    '@type': type.googleapis.com/aeraki.meta_protocol_proxy.filters.ratelimit.v1alpha.RateLimit
                    match:
                      metadata: 
                        - name: func
                          exact_match: /trpc.qsl_test.qsl_test.Helloworl/SayNo
                    domain: limit_tst
                    failure_mode_deny: false
                    actions:
                      - property: func
                        descriptor_key: func      
                    rate_limit_service:
                      grpc_service:
                        envoy_grpc:
                          cluster_name: ratelimit
                      transport_api_version: V3
                      
              routeConfig:
                routes:
                  - name: default
                    match:
                      metadata:
                        - name: func
                          #exact_match: /trpc.test.helloworld.Greeter/SayHello
                    route:
                      cluster: trpc.trpc.command
              statPrefix: trpc.trpc.command

  clusters:
  - name: trpc.trpc.command
    type: STATIC
    connect_timeout: 5s
    load_assignment:
      cluster_name: trpc.trpc.command
      endpoints:
        - lb_endpoints:
            - endpoint:
                address:
                  socket_address:
                    address: 127.0.0.1
                    port_value: 8000
  - name: ratelimit
    type: STATIC
    connect_timeout: 5s
    load_assignment:
      cluster_name: ratelimit
      endpoints:
        - lb_endpoints:
            - endpoint:
                address:
                  socket_address:
                    address: 9.134.187.103
                    port_value: 25000
